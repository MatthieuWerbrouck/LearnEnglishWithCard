<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Affichage des scores de th√®mes</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>üß™ Test - Affichage des scores de th√®mes</h1>
        
        <div id="testResults" style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
            <h3>R√©sultats du test :</h3>
            <div id="output"></div>
        </div>
        
        <button onclick="runTest()" class="main-btn">Lancer le test</button>
        
        <div style="margin-top: 20px;">
            <h3>Instructions :</h3>
            <ol>
                <li>Cliquez sur "Lancer le test"</li>
                <li>V√©rifiez que les fonctions de scores sont charg√©es</li>
                <li>Cr√©ez quelques scores de test</li>
                <li>V√©rifiez l'affichage dans les logs</li>
            </ol>
        </div>
    </div>

    <script src="dom-utils.js"></script>
    <script src="revision.js"></script>
    <script>
        function runTest() {
            const output = document.getElementById('output');
            let results = '<div style="font-family: monospace;">';
            
            // Test 1: V√©rifier que les fonctions sont charg√©es
            results += '<h4>üìã Test 1: Chargement des fonctions</h4>';
            results += `getScoreForTheme disponible: <strong>${typeof getScoreForTheme === 'function' ? '‚úÖ OUI' : '‚ùå NON'}</strong><br>`;
            results += `getThemeScores disponible: <strong>${typeof getThemeScores === 'function' ? '‚úÖ OUI' : '‚ùå NON'}</strong><br>`;
            
            if (typeof getScoreForTheme !== 'function') {
                results += '<div style="color: red; margin: 10px 0;">‚ùå ERREUR: Les fonctions de scores ne sont pas charg√©es!</div>';
                output.innerHTML = results + '</div>';
                return;
            }
            
            // Test 2: Cr√©er des scores de test
            results += '<h4>üìù Test 2: Cr√©ation de scores de test</h4>';
            
            try {
                // Utiliser les fonctions pour cr√©er des scores de test
                if (typeof updateScoreForTheme === 'function') {
                    // Cr√©er des scores pour diff√©rents th√®mes
                    const testData = [
                        { lang: 'anglais', theme: 'Animaux', score: 3 },
                        { lang: 'anglais', theme: 'Nourriture', score: 8 },
                        { lang: 'anglais', theme: 'Maison', score: 6 },
                        { lang: 'anglais', theme: 'Transport', score: null } // Nouveau
                    ];
                    
                    testData.forEach(({ lang, theme, score }) => {
                        if (score !== null) {
                            // Simule plusieurs bonnes/mauvaises r√©ponses pour atteindre le score souhait√©
                            for (let i = 0; i < 10; i++) {
                                const isGood = i < score; // Les premi√®res r√©ponses sont bonnes
                                updateScoreForTheme(lang, theme, isGood);
                            }
                            results += `Cr√©√© score pour ${theme}: ${getScoreForTheme(lang, theme)}/10<br>`;
                        }
                    });
                }
            } catch (error) {
                results += `<div style="color: orange;">‚ö†Ô∏è Erreur cr√©ation scores: ${error.message}</div>`;
            }
            
            // Test 3: V√©rifier la r√©cup√©ration des scores
            results += '<h4>üîç Test 3: R√©cup√©ration des scores</h4>';
            
            const testThemes = ['Animaux', 'Nourriture', 'Maison', 'Transport', 'Couleurs'];
            testThemes.forEach(theme => {
                const score = getScoreForTheme('anglais', theme);
                const status = score !== null ? `${score}/10` : 'nouveau';
                const emoji = score === null ? 'üÜï' : 
                             score >= 8 ? 'üèÜ' : 
                             score >= 6 ? '‚≠ê' : 
                             score >= 4 ? 'üìà' : 'üí™';
                
                results += `${emoji} ${theme}: <strong>${status}</strong><br>`;
            });
            
            // Test 4: Test du tri
            results += '<h4>üìä Test 4: Simulation du tri</h4>';
            
            const sortedThemes = testThemes.sort((a, b) => {
                const scoreA = getScoreForTheme('anglais', a);
                const scoreB = getScoreForTheme('anglais', b);
                
                if (scoreA === null && scoreB === null) return a.localeCompare(b);
                if (scoreA === null) return -1;
                if (scoreB === null) return 1;
                
                return scoreA - scoreB;
            });
            
            results += 'Ordre apr√®s tri:<br>';
            sortedThemes.forEach((theme, index) => {
                const score = getScoreForTheme('anglais', theme);
                const status = score !== null ? `${score}/10` : 'nouveau';
                results += `${index + 1}. ${theme} (${status})<br>`;
            });
            
            // Test 5: Afficher les donn√©es brutes
            results += '<h4>üóÉÔ∏è Test 5: Donn√©es de localStorage</h4>';
            try {
                const rawScores = getThemeScores();
                results += `Nombre de scores stock√©s: <strong>${Object.keys(rawScores).length}</strong><br>`;
                Object.entries(rawScores).forEach(([key, data]) => {
                    results += `${key}: ${JSON.stringify(data)}<br>`;
                });
            } catch (error) {
                results += `<div style="color: red;">‚ùå Erreur lecture localStorage: ${error.message}</div>`;
            }
            
            results += '</div>';
            output.innerHTML = results;
            
            console.log('üß™ Test termin√© - V√©rifiez les r√©sultats ci-dessus');
        }
        
        // Test automatique au chargement
        window.addEventListener('load', () => {
            console.log('üöÄ Page de test charg√©e');
            console.log('üìã Fonctions disponibles:');
            console.log('  - getScoreForTheme:', typeof getScoreForTheme);
            console.log('  - getThemeScores:', typeof getThemeScores);
            console.log('  - updateScoreForTheme:', typeof updateScoreForTheme);
        });
    </script>
</body>
</html>